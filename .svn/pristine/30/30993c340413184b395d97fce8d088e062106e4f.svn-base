
;=============================================================================
;                  声明
; 该程序仅供参考若程序中存在疏漏， 
; 芯海科技有限公司对此不承担任何责任。
; (C)Shenzhen Chipsea Technologies Co.,Ltd
;=============================================================================
; filename: CS_MeasureVoltage.asm
; chip    : CSU18M88
; author  : CS0138
; date    : 2017-06-27
; v1.0
;=============================================================================

;-----------------------------------------------------------------------------	
; DEFINE SFR
;-----------------------------------------------------------------------------


;-----------------------------------------------------------------------------	
; DEFINE CONSTANCE
;-----------------------------------------------------------------------------


;-----------------------------------------------------------------------------
; DEFINE SRAM
;-----------------------------------------------------------------------------
	;-----------------------------------------------
	;System(Reuse)
	;-----------------------------------------------	
	;R_TEMP1
	;R_TEMP2


/*通过标志位区分首次上电*/
/*通过标志位区分首次上电*/
/*通过标志位区分首次上电*/

/*----------------------------------------------------------------------------
函数名称：F_Initial_SOC(1)
具体描述：初始化SOC的配置
----------------------------------------------------------------------------*/
F_Init_SOC:
	;-----------------------------------------------------------------
	;清中断使能/状态寄存器
	;-----------------------------------------------------------------
	;需要判断首次上电，以免造成INTF清零
	;需要判断首次上电，以免造成INTF清零
	;需要判断首次上电，以免造成INTF清零
	clrf		INTE
	clrf		INTE2
	clrf		INTE3	
	clrf		INTF
	clrf		INTF2
	clrf		INTF3
	clrf		BSR

	;-----------------------------------------------------------------
	;设置MCK寄存器：CPUCLK = MCK/4 = 8MHz/4 = 2MHz
	;-----------------------------------------------------------------	
	movlw		00111110b			;MCK:(上电默认值为:00100010)
	movwf		MCK					;Bit7   ick_ldo_by: ick_ldo_bypass功能控制
									;	0 = 打开ICK模块的LDO*
									;	1 = 关闭ICK模块的LDO
	
									;Bit6-4 M3_CK M2_CK M1_CK: 指令周期配置	
									;	000 = MCK/32
									;	001 = MCK/16
									;	010 = MCK/8
									;	011 = MCK/4*
									;	1xx = MCK/2(不可配置)
	
									;Bit3	ECK_EN: 外部晶振1(32768Hz)启动开关
									;	0 = 外部晶振1关闭
									;	1 = 外部晶振1打开*
	
									;Bit2	WDT_CLK_EN: 内部WDT时钟启动开关
									;	0 = WDT_CLK关闭
									;	1 = WDT_CLK启动*
	
									;Bit1	ICK_EN: 内部高速时钟启动开关	
									;	0 = 内部时钟关闭
									;	1 = 内部时钟启动*
	
									;Bit0	CLK_SEL: 时钟源选择位	
									;	0 = 内部时钟作为系统时钟*
									;	1 = 外部晶振作为系统时钟	

	;-----------------------------------------------------------------
	;设置WDTCON寄存器：0.25s 
	;注：WDT时钟源由WDTEN控制
	;-----------------------------------------------------------------
	;建议使能WDT，尤其在NVR写操作期间
	;建议使能WDT，尤其在NVR写操作期间
	;建议使能WDT，尤其在NVR写操作期间
	bcf			WDTCON,WDTEN		;关闭WDT

;	bsf			WDTCON,2			;3'b110 = 0.25s(@WDTIN=BBH)<详见Datasheet>
;	bsf			WDTCON,1
;	bcf			WDTCON,0
;	
;	movlw		bbh
;	movwf		WDTIN	
;	
;	bsf			WDTCON,WDTEN	
	
	;-----------------------------------------------------------------
	;初始化RAM
	;-----------------------------------------------------------------
	;需要判断首次上电，以免造成RAM重置
	;需要判断首次上电，以免造成RAM重置
	;需要判断首次上电，以免造成RAM重置
	call		F_Init_RAM

	;-----------------------------------------------------------------
	;初始化I/O口
	;-----------------------------------------------------------------
	call		F_Init_IO
	
	;-----------------------------------------------------------------
	;初始化串口
	;-----------------------------------------------------------------	
	;call		F_Uart1_Init
	
	;-----------------------------------------------------------------
	;初始化SPI
	;-----------------------------------------------------------------
	;call		F_SPI_Init
	
	
	;-----------------------------------------------------------------
	;设置24bit-ADC
	;-----------------------------------------------------------------
	;VS=2.45V/DR=30.5Hz
	;如果使用2节干电池时，VS选择2.35V
	;-----------------------------------------------------------------	
	movlw		11000000b			;ANACFG:(上电默认值为:00000000)
	movwf		ANACFG				;Bit7	LDOEN: LDO电源使能信号
									;	0 = LDO电源不使能
									;	1 = LDO电源使能*
									
									;Bit6-5	LDOS[1:0]: VS电压值选择
									;	00 = VS=3.3V
									;	01 = VS=3.0V
									;	10 = VS=2.45V*
									;	11 = VS=2.35V
									
									;Bit4	BGR_ENB: bandgap使能
									;	0 = 打开bandgap*
									;	1 = 关闭bandgap
									
									;Bit3	BGID: ADC模式选择，与METCH[3]控制ADC模式(Metch[3]默认值0)
									;	BGID=0/METCH[3]=x	低功耗模式*
									;	BGID=1/METCH[3]=0	高性能模式
									;	BGID=1/METCH[3]=1	加强高性能模式
	
									;Bit2-1	SINL[1:0]: ADC通道选择
									;	00 = 24bit-ADC输入端连接到AIN0和AIN1，AIN0为Vin+，AIN1为Vin-*
									;	01 = 内短
									;	10 = 24bit-ADC输入端连接到TEMP
									;	11 = 24bit-ADC输入端连接到AIN2和AIN3，AIN2为Vin+，AIN3为Vin-
	
									;Bit0	ADEN: 24Bit-ADC使能标志
									;	0 = 24bit-ADC不使能*
									;	1 = 24bit-ADC使能

	bcf			ADCON,7				;	1'b1 = <关闭>加强高性能模式
	
	bsf			ADCON,3				;	4'b1101 = CK_SMP/8192 = 30.5Hz<详见Datasheet>
	bsf			ADCON,2
	bcf			ADCON,1
	bsf			ADCON,0

	movlw		11101000b			;ADCFG:(上电默认值为:00000000)
	movwf		ADCFG				;Bit7-5	ADSC/F_GAIN[1:0]: ADC的采样时钟频率选择(CK_SMP)
									;	0/00 = ICK/4/8
									;	0/01 = ICK/4/8
									;	0/10 = ICK/4/12
									;	0/11 = ICK/4/16
									;	1/00 = ICK/2/8
									;	1/01 = ICK/2/8
									;	1/10 = ICK/2/12
									;	1/11 = ICK/2/16* --> CK_SMP = 8MHz/2/16 = 250KHz
	
									;Bit4-2	S_GAIN[1:0]/R_GAIN:

									;ADC的PGA选择: F_GAIN[1:0]/R_GAIN/S_GAIN[1:0]
									;	00/0/00 = Gain = 1
									;	00/0/01 = Gain = 10
									;	00/0/10 = Gain = 20
									;	00/0/11 = Gain = 21
									;	00/1/00 = Gain = 2.5
									;	00/1/01 = Gain = 25
									;	00/1/10 = Gain = 50
									;	00/1/11 = Gain = 52.5
	
									;	01/0/00 = Gain = 8
									;	01/0/01 = Gain = 80
									;	01/0/10 = Gain = 160
									;	01/0/11 = Gain = 168
									;	01/1/00 = Gain = 20
									;	01/1/01 = Gain = 200
									;	01/1/10 = Gain = 400
									;	01/1/11 = Gain = 420	

									;	10/0/00 = Gain = 12
									;	10/0/01 = Gain = 120
									;	10/0/10 = Gain = 240
									;	10/0/11 = Gain = 252
									;	10/1/00 = Gain = 30
									;	10/1/01 = Gain = 300
									;	10/1/10 = Gain = 600
									;	10/1/11 = Gain = 630
	
									;	11/0/00 = Gain = 16 
									;	11/0/01 = Gain = 160
									;	11/0/10 = Gain = 320
									;	11/0/11 = Gain = 336*
									;	11/1/00 = Gain = 40
									;	11/1/01 = Gain = 400 
									;	11/1/10 = Gain = 800 
									;	11/1/11 = Gain = 840	

									;Bit1-0	CHOPM[1:0]: 24bit-ADC斩波选择
									;	00 = 斩波频率设置为采样频率的1/32*
									;	01 = 关闭斩波
									;	10 = 斩波频率设置为采样频率的1/256
									;	11 = 关闭斩波

	;<整机测试后在确定参数>
	movlw		01000000b			;TEMPC:(上电默认值为:00000000)
	movwf		TEMPC				;Bit7-4	TEMPC[7:4]: 增益温度特性补偿(ppm)@2.4V
									;	011/0 = -130
									;	010/0 = -90*
									;	001/0 = -45
									;	000/0 = 0
									;	100/0 = 0
									;	101/0 = 45
									;	110/0 = 90
									;	111/0 = 130
									;	011/1 = -13
									;	010/1 =	-9
									;	001/1 = -4
									;	000/1 = 0
									;	100/1 = 0
									;	101/1 = 4
									;	110/1 = 9
									;	111/1 = 13
	
									;Bit3-1	TEMPC[3:1]: 24bit-ADC模拟输入滤波器电阻阻值配置
									;	000 = 0.25k//0.25k//0.25k
									;	001 = 0.25k//0.25k
									;	010 = 0.25k//0.25k
									;	011 = 0.25k
									;	100 = 0.25k//0.25k
									;	101 = 0.25k
									;	110 = 0.25k
									;	111 = 0.25k
									
									;Bit0	NC
	
	movlw		20					;延时5ms(@cpuclk=2MHz)
	call		F_delay_1kclk	

	bsf			ANACFG,ADEN			;使能24bit-ADC

	;-----------------------------------------------------------------
	;设置10bit-ADC
	;-----------------------------------------------------------------
	bcf			LVDCON,AD2_REF		;10bit-ADC参考电压选择: DVDD
	
	movlw		00010100B			;AD2OH:(上电默认值为:00000u00)
	movwf		AD2OH				;Bit7   AD2EN: 10bit-ADC使能信号
									;	0 = 10bit-ADC不使能*
									;	1 = 10bit-ADC使能
									
									;Bit6	AD2_START: 10bit-ADC的转换开始信号，软件置1，当转化完成后硬件清0
									;	0 = 10bit-ADC转换完成，软件写0无效，硬件自动清零*
									;	1 = 开始进行10bit-ADC，软件写1有效
									
									;Bit5-2	AD2_SL[3:0]: 10bit-ADC通道选择
									;	0000 = PT2.7
									;	0001 = PT2.6
									;	0010 = PT2.3
									;	0011 = PT2.2
									;	0100 = PT2.1
									;	0101 = PT2.0*
									;	0110 = PT1.1
									;	0111 = PT1.0
									;	1000 = VS
									;	1001 = DVDD/2
									;	other = DVDD/2
									
									;Bit1-0	AD2O[9:8]: 10bit-ADC数据的高两位(Read Only)
							
	;-----------------------------------------------------------------
	;设置TM0
	;-----------------------------------------------------------------
	;TM0溢出时间 = (TM0IN+1) / TM0CLK
	;-----------------------------------------------------------------
	clrf		TM0CON
									;TM0CON:(上电默认值为:0000u100)
									;Bit7   T0EN: 定时器0使能位
									;	0 = 禁止TM0*
									;	1 = 使能TM0	

									;Bit6-4 T0RATE[2:0]: 定时器0时钟选择
									;		  TM0CLK=CPUCLK		TM0CLK=WDT/ECK
									;	000 = TM0CK				TM0CK
									;	001 = TM0CK/2			TM0CK/4
									;	010 = TM0CK/4			TM0CK/8
									;	011 = TM0CK/8			TM0CK/16
									;	100 = TM0CK/16			TM0CK/32
									;	101 = TM0CK/32			TM0CK/64
									;	110 = TM0CK/64			TM0CK/128
									;   111 = TM0CK/128			TM0CK/256
									
									;Bit3	NC
									
									;Bit2   T0RSTB: 定时器0复位
									;	0 = 使能TM0复位	
									;	1 = 禁止TM0复位
									
									;Bit1-0	T0SEL: 时钟源选择
									;	00 = CPUCLK
									;	01 = CPUCLK
									;	10 = 外部32768Hz晶振时钟 
									;	11 = 内部3K WDT时钟(仅当WDT时钟打开时有效)

	;-----------------------------------------------------------------
	;设置TM1
	;-----------------------------------------------------------------
	clrf		TM1CON	
									;TM1CON:(上电默认值为:00000100)
									;Bit7   T1EN: 定时器1使能位
									;	0 = 禁止TM1/CT1*
									;	1 = 使能TM1/CT1	

									;Bit6-4 T1RATE[2:0]: 定时器1时钟选择
									;	000 = CPUCLK	
									;	001 = CPUCLK/2
									;	010 = CPUCLK/4
									;	011 = CPUCLK/8
									;	100 = CPUCLK/16
									;	101 = CPUCLK/32
									;	110 = CPUCLK/64
									;   111 = CPUCLK/128
									
									;Bit3	T1CKS: 定时/计数器1时钟源选择位
									;	0 = CPUCLK的分频时钟
									;	1 = PT2.4作为时钟源
									
									;Bit2   T1RSTB: 定时/计数器1复位
									;	0 = 使能TM1/CT1复位
									;	1 = 禁止TM1/CT1复位	

									;Bit1-0	T1OUT_PWM1OUT: PT1.7/PT2.6口输出控制
									;	00 = IO输出
									;	01 = 蜂鸣器输出
									;	10 = PWM1输出 
									;	11 = PWM1取反输出	

	;-----------------------------------------------------------------
	;设置TM2
	;-----------------------------------------------------------------		
	clrf		TM2CON	
									;TM2CON:(上电默认值为:00000100)
									;Bit7   T2EN: 定时器2使能位
									;	0 = 禁止TM2/CT2*
									;	1 = 使能TM2/CT2	

									;Bit6-4 T2RATE[2:0]: 定时器2时钟选择
									;	000 = CPUCLK	
									;	001 = CPUCLK/2
									;	010 = CPUCLK/4
									;	011 = CPUCLK/8
									;	100 = CPUCLK/16
									;	101 = CPUCLK/32
									;	110 = CPUCLK/64
									;   111 = CPUCLK/128
									
									;Bit3	T2CKS: 定时/计数器2时钟源选择位
									;	0 = CPUCLK的分频时钟
									;	1 = PT2.5作为时钟源
									
									;Bit2   T2RSTB: 定时/计数器2复位
									;	0 = 使能TM2/CT2复位
									;	1 = 禁止TM2/CT2复位	

									;Bit1-0	T2OUT_PWM2OUT: PT1.6/PT2.7口输出控制
									;	00 = IO输出
									;	01 = IO输出
									;	10 = PWM2输出 
									;	11 = PWM2取反输出	

	;-----------------------------------------------------------------
	;设置TM3
	;-----------------------------------------------------------------
	clrf		TM3CON
									;TM3CON:(上电默认值为:00000100)
									;Bit7   T3EN: 定时器3使能位
									;	0 = 禁止TM3*
									;	1 = 使能TM3	

									;Bit6-4 T3RATE[2:0]: 定时器3时钟选择
									;	TM3CLK=CPUCLK				TM3CLK=WDT
									;	000 = TM3CK					TM3CK				
									;	001 = TM3CK/2				TM3CK/4
									;	010 = TM3CK/4				TM3CK/8
									;	011 = TM3CK/8				TM3CK/16
									;	100 = TM3CK/16				TM3CK/32
									;	101 = TM3CK/32				TM3CK/64
									;	110 = TM3CK/64				TM3CK/128
									;   111 = TM3CK/128				TM3CK/256
									
									;Bit3	T3SEL: 定时器3时钟源选择位
									;	0 = CPUCLK的分频时钟
									;	1 = 内部3K WDT时钟(仅当WDT时钟打开时有效)
									
									;Bit2   T3RSTB: 定时器3复位
									;	0 = 使能TM3复位
									;	1 = 禁止TM3复位	

									;Bit1-0	T3OUT_PWM3OUT: PT1.5/PT2.1口输出控制
									;	00 = IO输出
									;	01 = 蜂鸣器输出
									;	10 = PWM3输出 
									;	11 = PWM3取反输出	

	;-----------------------------------------------------------------	
	;设置BZ
	;-----------------------------------------------------------------
;	bsf			PCK,1				;S_BEEP1/S_BEEP0: BZ=4KHz@ICK=8MHz
;	bcf			PCK,0		

	;-----------------------------------------------------------------
	;设置LCD
	;-----------------------------------------------------------------
	;3.2V(@Sample)
	;10Kohm
	;61Hz
	;A Mode
	;1/3bias
	;1/4duty
	;-----------------------------------------------------------------	
	movlw		ffh
	movwf		SEGCON0				;SEGCON0:(上电默认值为:00000000)
									;Bit7-0	SEGCON0[7:0]: PT4.7~PT4.0 LCD SEG功能使能<不支持位控制>
									;	00000000 = 禁止LCD SEG功能
									;	11111111 = 使能LCD SEG功能*

	movlw		ffh
	movwf		SEGCON1				;SEGCON1:(上电默认值为:00000000)										
									;Bit7-0	SEGCON1[7:0]: PT3.7~PT3.0 LCD SEG功能使能
									;	00000000 = 禁止LCD SEG功能
									;	11111111 = 使能LCD SEG功能*
	
	movlw		01100010b
	movwf		LCDCN1				;LCDCN1:(上电默认值为:u0000u00)
									;Bit7	NC	

									;Bit6-5 LCDFC[1:0]: 快速充电模式脉宽选择
									;	00 = 1/2com周期
									;	01 = 1/4com周期
									;	10 = 1/8com周期 
									;	11 = 1/16com周期
									
									;Bit4	WDT_LCD: 选择WDT作为时钟源
									;	0 = 其它时钟源*
									;	1 = WDT作为时钟源
		
									;Bit3	CSE_LCD: 选择外部低速晶振作为时钟源
									;	0 = 其它时钟源*
									;	1 = 外部低速晶振作为时钟源

									;Bit2	NC	

									;Bit1-0	VLCDX[1:0]: VLCD输出电压选择
									;	00 = 2.6V
									;	01 = 2.8V
									;	10 = 3.0V 
									;	11 = 3.2V* <暂定>
		
	movlw		11110011b
	movwf		LCDCN2				;LCDCN2:(上电默认值为:00000000)
									;Bit7-4	LCDSCLKS[3:0]: LCD帧频选择<详见Datasheet> --> LCD_DCLK = 8MHz/256/32 = 976Hz	

									;Bit3	LCDFR: LCD充电模式波形选择
									;	0 = 快速充电模式A波形
									;	1 = 快速充电模式B波形
		
									;Bit2-0	LCDREF[2:0]: LCD分压电阻选择
									;	000 = 100Kohm				
									;	001 = 50Kohm
									;	010 = 20Kohm
									;	011 = 10Kohm* <暂定>
									;	100 = 快速充电模式，20Kohm/100Kohm电阻切换
									;	101 = 快速充电模式，20Kohm/200Kohm电阻切换
									;	110 = 快速充电模式，10Kohm/100Kohm电阻切换
									;   111 = 快速充电模式，10Kohm/100Kohm电阻切换	
		
	movlw		10000111b
	movwf		LCDENR 				;LCDENR:(上电默认值为:11000000)	
									;Bit7-6	LCDCKS[1:0]: LCD帧频选择
									;	00 = LCD输入时钟频率的1/2
									;	01 = LCD输入时钟频率的1/4
									;	10 = LCD输入时钟频率的1/8
									;	1    1 = LCD输入时钟频率的1/16* --> LCDCLK = 976Hz/16 = 61Hz
		
									;Bit5	LCDEN: LCD驱动器使能标志
									;	0 = LCD驱动器不使能<LCD的时钟被停止>*
									;	1 = LCD驱动器使能<LCD的时钟被启动>
		
									;Bit4	LCDWS: LCD充电模式波形选择
									;	0 = A波形*
									;	1 = B波形		

									;Bit3	LEVEL: LCD驱动器的偏置电压选择器
									;	0 = 1/3bias*
									;	1 = 1/2bias
		
									;Bit2-1	LCD_DUTY[1:0]: LCD驱动器控制模式(SEG duty周期)
									;	00 = 1/6duty周期模式
									;	01 = 1/2duty周期模式
									;	10 = 1/3duty周期模式
									;	11 = 1/4duty周期模式*	
		
									;Bit0	ENPMPL: LCD charge pump使能标志位
									;	0 = LCD charge pump关闭
									;	1 = LCD charge pump打开*
		
	movlw		2					;延时0.5ms(@cpuclk=2MHz)
	call		F_delay_1kclk	

	bsf			LCDENR,LCDEN		;使能LCD		

	

	;-----------------------------------------------------------------
	;设置IIC
	;-----------------------------------------------------------------
	clrf		I2CCON							
	
	;-----------------------------------------------------------------
	;设置RTC
	;-----------------------------------------------------------------
	;需要判断首次上电，以免造成RTC重置
	;需要判断首次上电，以免造成RTC重置
	;需要判断首次上电，以免造成RTC重置
	
	;BCF			WDTCON,AIENB3		;PT1.0/1.1定义为模拟接口，外部晶振输入
	;-------------------------------

	
	;-------------------------------	
	movlw		96h					;使能RTC写操作
	movwf		RTCAER

	;-------------------------------
	;2017-06-28 16:42:38 Wednesday
	movlw		17h
	movwf		RTCYEAR				;<Year>(BCD)
		
	movlw		06h
	movwf		RTCMON				;<Month>
	
	movlw		28h
	movwf		RTCDAY				;<Date>
		
	movlw		16h
	movwf		RTCHOUR				;<Hour>
									;Bit6	AM_PM: 0表示AM，1表示PM

									;Bit5-4	10HR: 10HourTimeDigit(0~2)

									;Bit3-0	1HR: 1HourTimeDigit(0~9)

	movlw		42h
	movwf		RTCMIN				;<Minute>	
	
	movlw		38h
	movwf		RTCSEC 				;<Second>	
	
	movlw		03
	movwf		RTCDWR 				;<Day> --> 星期		
	
	;-------------------------------
	movlw		00110111b
	movwf		RTCCON				;RTCCON:(上电默认值为:0u000111)
									;Bit7	LIR: 闰年指示寄存器(Read Only)
									;	0 = 该年非闰年
									;	1 = 该年为闰年

									;Bit6	NC

									;Bit5	24hr/12hr: 24小时/12小时模式选择
									;	0 = 选择12小时制，带AM和PM指示			
									;	1 = 选择24小时制*
		
									;Bit4	RTCEN: RTC使能控制
									;	0 = RTC功能禁止			
									;	1 = RTC功能使能*
	
									;Bit3-0	INTEGER[3:0]: RTC 时钟补偿整数部分，每秒钟补偿一次
									;默认值0111<详见Datasheet>

	clrf		RTCAER				;禁用RTC写操作	
	
	;-----------------------------------------------------------------
	;初始化中断
	;-----------------------------------------------------------------
	;<注：对UART1寄存器及其中断寄存器某些bit操作时，需要ROOT_EN=1>
	;<注：对UART1寄存器及其中断寄存器某些bit操作时，需要ROOT_EN=1>
	;<注：对UART1寄存器及其中断寄存器某些bit操作时，需要ROOT_EN=1>
	bsf			INTE,GIE			;使能总中断
	bsf			INTE,ADIE			;使能24bit-ADC中断
	bsf			INTE2,UR1_RNIE		;串口1接收FIFO非空中断使能 --> <详见Datasheeet>
	bsf			INTE3,RTCIE			;使能RTC中断
	;
	;
	;

	;-------------------------------		
	return


/*----------------------------------------------------------------------------
函数名称：F_Init_IO
具体描述：初始化IO口
------------------------------------------------------------------------------
说明1：未使用的端口设置为output 0
说明2：PT1上拉电阻选择10Kohm或者30Kohm，由METCH[0]控制，METCH[0]=0上拉选择30Kohm，METCH[0]=1上拉选择10Kohm	
说明3：PT2上拉电阻选择10Kohm或者30Kohm，由METCH[1]控制，METCH[0]=0上拉选择30Kohm，METCH[1]=1上拉选择10Kohm	
说明4：PT5上拉电阻选择10Kohm或者30Kohm，由METCH[2]控制，METCH[0]=0上拉选择30Kohm，METCH[0]=1上拉选择10Kohm
----------------------------------------------------------------------------*/
F_Init_IO:
	BCF			ADCON,4				;METCH[0]/PT1上拉电阻30Kohm
	BCF			ADCON,5				;METCH[1]/PT2上拉电阻30Kohm	
	BCF			ADCON,6				;METCH[2]/PT5上拉电阻30Kohm		

	BCF			WDTCON,AIENB3		;PT1.0/1.1定义为模拟接口，外部晶振输入<注：AIENB3=1，PT1.0/1.1定义为非晶振接口>
;	BSF			LVDCON,AIENB1		;PT2.0定义为数字接口<注：AIENB1=0，PT2.0定义为模拟接口，低电压检测输入口>
;	
	;IIC VDD

	;-------------------------------
	;PT1端口
	;-------------------------------
	;
	;RX1		   = input/pull/high		--> PT1.7
	;TX1	       = output/no-pull/high	--> PT1.6
	;FM24C02A_CS   = output/no-pull/high	-->	PT1.5
	;FM24C02A_SCLK = output/no-pull/low		-->	PT1.4
	;FM24C02A_MOSI = output/no-pull/low		-->	PT1.3
	;FM24C02A_MISO = input/no-pull/low		-->	PT1.2(Z)
	;XOUTL		   = NC						--> PT1.1
	;XINL		   = NC						--> PT1.0
	;-------------------------------	
	MOVLW		01111000B			;PT1EN:(上电默认值:00000000)
	MOVWF		PT1EN 				;	0 = 定义为输入口
									;	1 = 定义为输出口
	
	MOVLW		10000000B			;PT1PU:(上电默认值:00000000)	
	MOVWF		PT1PU				;	0 = 断开上拉电阻
									;	1 = 使用上拉电阻

	MOVLW		11100000B			;PT1:(上电默认值:xxxxxxxx)			
	MOVWF		PT1			

;	MOVLW		11011111B			;AIENB:(上电默认值:11111111)			
;	MOVWF		AIENB				;Bit7	AIENB2[7]: PT1.0数模接口定义，默认为数字口
									;	0 = 并且AIENB3=1时为ADC模拟输入
									;	1 = 并且AIENB3=1为数字接口
									
									;Bit6	AIENB2[6]: PT1.1数模接口定义，默认为数字口
									;	0 = 并且AIENB3=1时为ADC模拟输入
									;	1 = 并且AIENB3=1为数字接口
	
									;Bit5	AIENB2[5]: PT2.0数模接口定义，默认为数字口
									;	0 = PT2.0定义为模拟接口*
									;	1 = PT2.0定义为数字接口
	
									;Bit4	AIENB2[4]: PT2.1数模接口定义，默认为数字口
									;	0 = PT2.1定义为模拟接口
									;	1 = PT2.1定义为数字接口	
	
									;Bit3	AIENB2[3]: PT2.2数模接口定义，默认为数字口
									;	0 = PT2.2定义为模拟接口
									;	1 = PT2.2定义为数字接口		
	
									;Bit2	AIENB2[2]: PT2.3数模接口定义，默认为数字口
									;	0 = PT2.3定义为模拟接口
									;	1 = PT2.3定义为数字接口		
	
									;Bit1	AIENB2[1]: PT2.6数模接口定义，默认为数字口
									;	0 = PT2.6定义为模拟接口
									;	1 = PT2.6定义为数字接口
									;当串口1选择PT2.6作为串口1的RX；PT2.7作为串口1的TX串口时候(UART1_SEL=1)，只有当ROOT_EN=1，才能改变此项
	
									;Bit0	AIENB2[0]: PT2.7数模接口定义，默认为数字口
									;	0 = PT2.7定义为模拟接口
									;	1 = PT2.7定义为数字接口
									;当串口1选择PT2.6作为串口1的RX；PT2.7作为串口1的TX串口时候(UART1_SEL=1)，只有当ROOT_EN=1，才能改变此项
									
									;串口通信1 UART1_SEL接口选择：
									;	0 = PT1.7作为串口1的RX；PT1.6作为串口1的TX
									;	1 = PT2.6作为串口1的RX；PT2.7作为串口1的TX
	
	;-------------------------------
	;PT2端口
	;-------------------------------
	;BackLight     = output/no-pull/high	--> PT2.7
	;WakeUp(M2S)   = output/no-pull/low     --> PT2.6
	;Status(S2M)   = input/pull/high        --> PT2.5
	;Key		   = input/pull/high        --> PT2.4
	;RX0           = input/pull/high        --> PT2.3
	;TX0           = output/no-pull/high    --> PT2.2
	;CS1256_SDA    = output/pull/high		--> PT2.1
	;WakeUp(M2S)   = output/no-pull/low     --> PT2.0
	;-------------------------------
	MOVLW		11111111B			;PT2EN:(上电默认值:00000000)
	MOVWF		PT2EN 				;	0 = 定义为输入口
									;	1 = 定义为输出口	
									
	MOVLW		00000000B			;PT2PU:(上电默认值:00000000)
	MOVWF		PT2PU				;	0 = 断开上拉电阻
									;	1 = 使用上拉电阻
									
	MOVLW		00000010B			;PT2:(上电默认值:xxxxxxxx)	
	MOVWF		PT2
	;----------------
	;-------------------------------
	;PT3端口
	;-------------------------------	
	MOVLW		11111111B			;PT3EN:(上电默认值:00000000)
	MOVWF		PT3EN 				;	0 = 定义为输入口
									;	1 = 定义为输出口	
	
	MOVLW		00000000B			;PT3PU:(上电默认值:00000000)
	MOVWF		PT3PU				;	0 = 断开上拉电阻
									;	1 = 使用上拉电阻
	
	MOVLW		00000000B			;PT3:(上电默认值:xxxxxxxx)	
	MOVWF		PT3	

	;-------------------------------
	;PT4端口
	;-------------------------------											
	MOVLW		11111111B			;PT4EN:(上电默认值:00000000)
	MOVWF		PT4EN
	
	MOVLW		00000000B			;PT4PU:(上电默认值:00000000)
	MOVWF		PT4PU	
	
	MOVLW		00000000B			;PT4:(上电默认值:xxxxxxxx)	
	MOVWF		PT4	

	;-------------------------------
	;PT5端口
	;-------------------------------	
	MOVLW		11111111B			;PT5EN:(上电默认值:11100000)
	MOVWF		PT5EN				
									;Bit6 SMT2_EN，PT2.0~PT2.7 输入施密特使能控制信号
									;0 = PT2.0~PT2.7 输入施密特使能关闭
									;1 = PT2.0~PT2.7 输入施密特使能打开，默认打开
									;Bit5 SMT1_EN，PT1.0~PT1.7 输入施密特使能控制信号
									;0 = PT1.0~PT1.7 输入施密特使能关闭
									;1 = PT1.0~PT1.7 输入施密特使能打开，默认打开
									;Bit0 PT5EN[0]：GPIO5 口输入/输出控制标志，默认为输入口
									;PT5EN[0] = GPIO5 bit 0 的 I/O 控制标志位；0 = 定义为输入口，1 = 定义为输出口
	
	MOVLW		00000000B			;PT5PU:(上电默认值:00000000)
	MOVWF		PT5PU	
	
	MOVLW		00000001B			;PT5:(上电默认值:000xxxxx)	
	MOVWF		PT5		

	;-------------------------------
	;Other Reg
	;-------------------------------
	MOVLW		00000000B			;PTCON:(上电默认值:00000000)	
	MOVWF		PTCON				
									;Bit 7 BZEN：蜂鸣器使能标志，默认不使能
									;1 = 使能蜂鸣器功能，PT2.1 为蜂鸣器输出接口
									;0 = 不使能蜂鸣器功能，PT2.1 定义普通用途 I/O 口
									;Bit 6: PWM3_SEL PT1.5/PT2.1 口输出选择信号
									;1：Timer3 的输出选择 PT2.1
									;0：Timer3 输出选择 PT1.5
									;Bit 5: PWM2_SEL PT1.6/PT2.5 口输出选择信号
									;1：Timer2 的输出选择 PT2.5
									;0：Timer2 的输出选择 PT1.6
									;Bit 4: PWM1_SEL PT1.7/PT2.4 口输出选择信号
									;1：Timer1 的输出选择 PT2.4
									;0：Timer1 的输出选择 PT1.7
									;Bit 3-2 E1M[1:0]：GPIO2 口 bit 1 中断触发模式
									;11 = 外部中断 1 在状态改变时触发
									;10 = 外部中断 1 在状态改变时触发
									;01 = 外部中断 1 为上升沿触发
									;00 = 外部中断 1 为下降沿触发
									;Bit 1-0 E0M[1:0]：GPIO2 口 bit 0 中断触发模式
									;11 = 外部中断 0 在状态改变时触发
									;10 = 外部中断 0 在状态改变时触发
									;01 = 外部中断 0 为上升沿触发
									;00 = 外部中断 0 为下降沿触发
	MOVLW		00000000B			;PTINT0:(上电默认值:00000000)	
	MOVWF		PTINT0				;Bit7	PTW0[7]: PT2.7外部中断0使能，默认为0
									;	0 = 禁止PT2.7外部中断0
									;	1 = 使能PT2.7外部中断0

									;Bit6	PTW0[6]: PT2.4外部中断0使能，默认为0
									;	0 = 禁止PT2.4外部中断0
									;	1 = 使能PT2.4外部中断0
									
									;Bit5	PTW0[5]: PT2.2外部中断0使能，默认为0
									;	0 = 禁止PT2.2外部中断0
									;	1 = 使能PT2.2外部中断0
									
									;Bit4	PTW0[4]: PT2.1外部中断0使能，默认为0
									;	0 = 禁止PT2.1外部中断0
									;	1 = 使能PT2.1外部中断0
	
									;Bit3	PTW0[3]: PT1.7外部中断0使能，默认为0
									;	0 = 禁止PT1.7外部中断0
									;	1 = 使能PT1.7外部中断0	
	
									;Bit2	PTW0[2]: PT1.4外部中断0使能，默认为0
									;	0 = 禁止PT1.4外部中断 0
									;	1 = 使能PT1.4外部中断 0
									
									;Bit1	PTW0[1]: PT1.2外部中断0使能，默认为0
									;	0 = 禁止PT1.2外部中断0
									;	1 = 使能PT1.2外部中断0
									
									;Bit0	PTW0[0]: PT1.1外部中断0使能，默认为0
									;	0 = 禁止PT1.1外部中断0
									;	1 = 使能PT1.1外部中断0

	MOVLW		00000000B			;PTINT1:(上电默认值:00000000)	
	MOVWF		PTINT1				;Bit7	PTW1[7]: PT2.6外部中断1使能，默认为0	
									;	0 = 禁止PT2.6外部中断1
									;	1 = 使能PT2.6外部中断1
	
									;Bit6	PTW1[6]: PT2.5外部中断1使能，默认为0
									;	0 = 禁止PT2.5外部中断1
									;	1 = 使能PT2.5外部中断1
	
									;Bit5	PTW1[5]: PT2.3外部中断1使能，默认为0
									;	0 = 禁止PT2.3外部中断1
									;	1 = 使能PT2.3外部中断1
	
									;Bit4	PTW1[4]: PT2.0外部中断1使能，默认为0
									;	0 = 禁止PT2.0外部中断1
									;	1 = 使能PT2.0外部中断1
	
									;Bit3	PTW1[3]: PT1.6外部中断1使能，默认为0
									;	0 = 禁止PT1.6外部中断1
									;	1 = 使能PT1.6外部中断1
	
									;Bit2	PTW1[2]: PT1.5外部中断1使能，默认为0
									;	0 = 禁止PT1.5外部中断1
									;	1 = 使能PT1.5外部中断1
	
									;Bit1	PTW1[1]: PT1.3外部中断1使能，默认为0
									;	0 = 禁止 PT1.3外部中断1
									;	1 = 使能 PT1.3外部中断1
	
									;Bit0	PTW1[0]: PT1.0外部中断1使能，默认为0
									;	0 = 禁止 PT1.0外部中断1
									;	1 = 使能 PT1.0外部中断1	
	
	movlw		ffh
	movwf		SEGCON0				;SEGCON0:(上电默认值为:00000000)
									;Bit7-0	SEGCON0[7:0]: PT4.7~PT4.0 LCD SEG功能使能<不支持位控制>
									;	00000000 = 禁止LCD SEG功能
									;	11111111 = 使能LCD SEG功能*

	movlw		ffh
	movwf		SEGCON1				;SEGCON1:(上电默认值为:00000000)								
									;Bit7-0	SEGCON1[7:0]: PT3.7~PT3.0 LCD SEG功能使能
									;	00000000 = 禁止LCD SEG功能
									;	11111111 = 使能LCD SEG功能*
	;-------------------------------								
	RETURN


/*----------------------------------------------------------------------------
函数名称：F_Init_RAM
具体描述：初始化RAM(896Bytes)=128B+256B+256B+256B
------------------------------------------------------------------------------
; FSR0 --> Addr
; IND0 --> Data
----------------------------------------------------------------------------*/
F_Init_RAM:	
	BCF			BSR,PAGE0				;2'b00<设置访问PAGE0>
	BCF			BSR,PAGE1
	;-----------
	BCF			BSR,IRP0				;<设置访问000H--0FFH区域RAM>
	MOVLW		80H						;080H--0FFH
	MOVWF		FSR0
Clear_RAM_Lp1:
	CLRF		IND0
	INCFSZ		FSR0,1
	GOTO		Clear_RAM_Lp1
	;-----------	
	BSF			BSR,IRP0				;<设置访问100H--1FFH区域RAM>
	MOVLW		00H
	MOVWF		FSR0
Clear_RAM_Lp2:
	CLRF		IND0
	INCFSZ		FSR0,1
	GOTO		Clear_RAM_Lp2
	;-----------------------------------
	BSF			BSR,PAGE0				;2'b01<设置访问PAGE1>
	BCF			BSR,PAGE1	
	;-----------		
	BSF			BSR,IRP0				;<设置访问100H--1FFH区域RAM>
	MOVLW		00H
	MOVWF		FSR0
Clear_RAM_Lp3:
	CLRF		IND0
	INCFSZ		FSR0,1
	GOTO		Clear_RAM_Lp3		
	;-----------------------------------		
	BCF			BSR,PAGE0				;2'b10<设置访问PAGE2>
	BSF			BSR,PAGE1	
	;-----------
	BSF			BSR,IRP0				;<设置访问100H--1FFH区域RAM>
	MOVLW		00H
	MOVWF		FSR0
Clear_RAM_Lp4:
	CLRF		IND0
	INCFSZ		FSR0,1
	GOTO		Clear_RAM_Lp4	
	;-----------------------------------	
	BCF			BSR,PAGE0	
	BCF			BSR,PAGE1	
	BCF			BSR,IRP0
	RETURN



		
	
	
	
	
	
	
	
	




